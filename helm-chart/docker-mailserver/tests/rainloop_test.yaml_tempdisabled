suite: rainloop tests
templates:
  - configmap.yaml
  - service.yaml
  - service_rainloop.yaml
  - ingress_rainloop.yaml
  - pvc_rainloop.yaml
  - deployment_rainloop.yaml
tests:
  - it: should configure imaps port 10993 for rainloop if enabled (and haproxy enabled)
    set:
      rainloop.enabled: true
      haproxy.enabled: true      
    asserts:
      - matchRegex:
          path: data.dovecot\.cf
          pattern: rainloop         
        template: configmap.yaml

  - it: should not configure imaps port 10993 for rainloop if disabled
    set:
      rainloop.enabled: false
      haproxy.enabled: true
    asserts:
      - notMatchRegex:
          path: data.dovecot\.cf
          pattern: rainloop         
        template: configmap.yaml        

  - it: should create rainloop service if enabled
    set:
      rainloop.enabled: true
    asserts:
      - hasDocuments:
          count: 1
        template: service_rainloop.yaml       

  - it: should not create rainloop service if disabled
    set:
      rainloop.enabled: false
    asserts:
      - hasDocuments:
          count: 0
        template: service_rainloop.yaml  

  - it: should create rainloop ingress if enabled
    set:
      rainloop.enabled: true
    asserts:
      - hasDocuments:
          count: 1
        template: ingress_rainloop.yaml       

  - it: should not create rainloop ingress if disabled
    set:
      rainloop.enabled: false
    asserts:
      - hasDocuments:
          count: 0
        template: ingress_rainloop.yaml  

  - it: should create rainloop pvc if enabled
    set:
      rainloop.enabled: true
    asserts:
      - hasDocuments:
          count: 1
        template: pvc_rainloop.yaml       

  - it: should not create rainloop pvc if disabled
    set:
      rainloop.enabled: false
    asserts:
      - hasDocuments:
          count: 0
        template: pvc_rainloop.yaml         

  - it: should create rainloop deployment if enabled
    set:
      rainloop.enabled: true
    asserts:
      - hasDocuments:
          count: 1
        template: deployment_rainloop.yaml       

  - it: should not create rainloop deployment if disabled
    set:
      rainloop.enabled: false
    asserts:
      - hasDocuments:
          count: 0
        template: deployment_rainloop.yaml            