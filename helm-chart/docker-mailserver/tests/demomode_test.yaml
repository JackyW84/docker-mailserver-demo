suite: haproxy tests
templates:
  - configmap.yaml
  - secret.yaml
tests:
  - it: should correctly configure configmaps if demo mode is enabled
    set:
      demo_mode.enabled: true
    asserts:
      - matchRegex:
          path: data.postfix-accounts\.cf
          pattern: user@example.com|{SHA512-CRYPT}$6$l4023rZnQEy/l0Rg$JeNjAAICB43VAX7GTJ9jeE7DR0LeyR5nU.ftq3c42T5E1IZSuRBqwM8erRh6t0CyIT6aYpBIAopzcQHNUvMV00
      - matchRegex:
          path: data.SigningTable
          pattern: \*\@example.com mail._domainkey.example.com
      - matchRegex:
          path: data.KeyTable
          pattern: mail._domainkey.example.com example.com:mail:/etc/opendkim/keys/example.com/mail.private
      - matchRegex:
          path: data.TrustedHosts
          pattern: 127.0.0.1
  - it: should correctly configure secrets if demo mode is enabled
    set:
      demo_mode.enabled: true
    asserts:
      - matchRegex:
          path: data.example\.com-mail\.private
          pattern: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS
        template: secret.yaml