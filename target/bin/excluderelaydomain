#! /bin/bash

# shellcheck source=../scripts/helpers/index.sh
source /usr/local/bin/helpers/index.sh

function __usage { echo 'Usage: excluderelayhost <domain>' ; }

function _validate_parameters
{
  [[ -z ${DOMAIN} ]] && { __usage ; _exit_with_error "no domain specified" ; }
}

function _exclude_domain_from_relayhosts
{
  local DATABASE_RELAY='/tmp/docker-mailserver/postfix-relaymap.cf'

  if grep -qi "^@${DOMAIN}" "${DATABASE_RELAY}" 2>/dev/null
  then
    sed -i "s/^@${DOMAIN}.*/@${DOMAIN}/" "${DATABASE_RELAY}"
  else
    echo -e "@${DOMAIN}" >> "${DATABASE_RELAY}"
  fi
}

DOMAIN="${1}"

_validate_parameters
_exclude_domain_from_relayhosts
