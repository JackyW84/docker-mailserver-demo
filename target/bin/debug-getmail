#! /bin/bash

# shellcheck source=../scripts/helpers/log.sh
source /usr/local/bin/helpers/log.sh
# shellcheck source=../scripts/startup/setup-stack.sh
source /usr/local/bin/setup.d/getmail.sh

_setup_getmail

if [[ -d /var/lib/getmail ]]
then
  GETMAILDIR=/var/lib/getmail
else
  if [[ -d /tmp/docker-mailserver/getmail ]]
  then
    mkdir -p /tmp/docker-mailserver/getmail
  fi
    GETMAILDIR=/tmp/docker-mailserver/getmail
fi

for FILE in /etc/getmailrc.d/getmailrc*
do
  /usr/local/bin/getmail --getmaildir "${GETMAILDIR}" --rcfile "${FILE}" --dump | tail -n +7
done
