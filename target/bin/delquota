#! /bin/bash

# shellcheck source=../scripts/helpers/index.sh
source /usr/local/bin/helpers/index.sh

function _main
{
  [[ ${1:-} == 'help' ]] && { __usage ; exit 0 ; }

  local MAIL_ACCOUNT="${1}"

  _validate_parameter_user
  _remove_quota_for_user
}

function __usage { echo 'Usage: delquota <username@domain>' ; }

function _validate_parameter_user
{
  _provided_mail_account_with_local_and_domain_parts

  local DATABASE='/tmp/docker-mailserver/postfix-accounts.cf'
  source ./common/helper.sh
  _account_should_already_exist
}

function _remove_quota_for_user
{
  local DATABASE_QUOTA='/tmp/docker-mailserver/dovecot-quotas.cf'

  [[ -s ${DATABASE_QUOTA} ]] || exit 0

  sed -i -e "/^${MAIL_ACCOUNT}:.*$/d" "${DATABASE_QUOTA}"
}

_main "${@}"
